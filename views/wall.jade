extends layout

block content
	h1(data-bind='text: milestone().title')

	div(id="container")
		div(data-bind="template: { name: 'status-column-template', foreach: columns }" )

	script(id='status-column-template', type='text/html')
		<div class='status-column'>
		<span data-bind="text: label" />
		<div data-bind="template: { name: 'ticket-template', foreach: tickets }" />
		</div>

	script(id='ticket-template', type='text/html')
		<div class='ticket' data-bind="attr : { class : 'ticket ' + custom_fields['Type'] }">
		<a data-bind="text: '#' + number, attr : { href: 'https://www.assembla.com/spaces/brightpt/tickets/' + number + '#/activity/ticket' }" />
		<span data-bind="text: summary" />
		<div class="user-label" data-bind="text: $root.findUser(assigned_to_id).name" />
		<div class="user-label" data-bind="text: $root.findUser(custom_fields['Offsider']).name" />
		</div>

	script(src='/javascripts/cardWallModel.js')
	script(type='text/javascript')		
		$(function(){ 

			var model = new CardWallModel('#{token}');
			ko.applyBindings(model);

			model.loadUsers();
			model.loadMilestone(2137233);
			

			setTimeout(function() { model.refresh(); }  , 30000);
		});
